<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GPA & CGPA Calculator</title>

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles for font -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-4xl mx-auto">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-white mb-2">Semester-wise CGPA Calculator</h2>
            <p class="text-center text-gray-400 mb-8">Select your final semester and enter your grades to calculate your CGPA.</p>
            
            <div class="controls flex flex-col sm:flex-row items-center justify-center gap-4 mb-8">
                <label for="semesterSelect" class="text-lg text-gray-300">Last Semester:</label>
                <select id="semesterSelect" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-indigo-500 focus:border-indigo-500"></select>
                <button onclick="startCalculation()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300">Start</button>
            </div>

            <div id="courseDisplay" class="text-center text-indigo-300 text-lg font-semibold min-h-[2.5em] mb-6"></div>

            <div class="keypad grid grid-cols-3 sm:grid-cols-6 gap-4 justify-center max-w-md mx-auto mb-8">
                <button onclick="submitGrade(10)" class="py-4 px-2 text-lg font-bold bg-gray-700 hover:bg-indigo-600 rounded-lg transition duration-300">O</button>
                <button onclick="submitGrade(9)" class="py-4 px-2 text-lg font-bold bg-gray-700 hover:bg-indigo-600 rounded-lg transition duration-300">A+</button>
                <button onclick="submitGrade(8)" class="py-4 px-2 text-lg font-bold bg-gray-700 hover:bg-indigo-600 rounded-lg transition duration-300">A</button>
                <button onclick="submitGrade(7)" class="py-4 px-2 text-lg font-bold bg-gray-700 hover:bg-indigo-600 rounded-lg transition duration-300">B+</button>
                <button onclick="submitGrade(6)" class="py-4 px-2 text-lg font-bold bg-gray-700 hover:bg-indigo-600 rounded-lg transition duration-300">B</button>
                <button onclick="submitGrade(5)" class="py-4 px-2 text-lg font-bold bg-gray-700 hover:bg-indigo-600 rounded-lg transition duration-300">C</button>
            </div>
            
            <div class="gpa-display text-center mb-8">
                <p class="text-2xl font-bold"><strong>Live CGPA:</strong> <span id="liveGPA" class="text-green-400">-</span></p>
                <p id="semWiseGPA" class="text-gray-400 mt-2 text-sm"></p>
            </div>
            
            <div class="grades flex flex-wrap justify-center gap-4 mb-8">
                <button onclick="correctGrade()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-5 rounded-lg transition duration-300">Correct Grade</button>
                <button onclick="restart()" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-5 rounded-lg transition duration-300">Restart</button>
                <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-5 rounded-lg transition duration-300">Print</button>
                <button onclick="downloadCSV()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-5 rounded-lg transition duration-300">Download CSV</button>
            </div>

            <div class="overflow-x-auto">
                <table id="resultTable" style="display:none" class="w-full text-sm text-left text-gray-400">
                    <thead class="text-xs text-gray-300 uppercase bg-gray-700">
                        <tr>
                            <th class="px-6 py-3">Course</th>
                            <th class="px-6 py-3 text-center">Grade</th>
                            <th class="px-6 py-3 text-center">Credits</th>
                            <th class="px-6 py-3 text-center">Grade Point</th>
                            <th class="px-6 py-3 text-center">Grade × Credits</th>
                            <th class="px-6 py-3 text-center">Weightage</th>
                            <th class="px-6 py-3">Semester</th>
                        </tr>
                    </thead>
                    <tbody class="bg-gray-800"></tbody>
                </table>
            </div>
            
            <!-- Link back to the main portfolio -->
            <div class="text-center mt-8">
                <a href="https://supersk2006.github.io/index.html" class="text-indigo-400 hover:text-indigo-300 transition duration-300">&larr; Back to Portfolio</a>
            </div>

        </div>
    </div>


    <!-- The original, unmodified JavaScript for calculator functionality -->
    <script>
        const courseData = {
            "Semester I": [
                { "Course Name": "Technical Communication I", Credits: 2 },
                { "Course Name": "Linear Algebra and Calculus", Credits: 4 },
                { "Course Name": "Chemistry for Electronics Engineering", Credits: 4 },
                { "Course Name": "Programming using C", Credits: 4 },
                { "Course Name": "Engineering Graphics", Credits: 4 },
                { "Course Name": "Engineering Practices - Electrical and Electronics", Credits: 1 },
                { "Course Name": "Indian Constitution and Freedom Movement", Credits: 0 },
                { "Course Name": "Heritage of Tamils", Credits: 1 }
            ],
            "Semester II": [
                { "Course Name": "Technical Communication II/English for Professional Competence", Credits: 1 },
                { "Course Name": "Differential Equation and Complex Variables", Credits: 4 },
                { "Course Name": "Physics for Electronics Engineering", Credits: 4 },
                { "Course Name": "Data Structures", Credits: 5 },
                { "Course Name": "Electric Circuits", Credits: 3 },
                { "Course Name": "Electric Circuits Laboratory", Credits: 1 },
                { "Course Name": "Engineering Practices - Civil and Mechanical", Credits: 1 },
                { "Course Name": "Environmental Science and Engineering", Credits: 0 },
                { "Course Name": "தமிழரும் தொழில்நுட்பமும் Tamils and Technology", Credits: 1 }
            ],
            "Semester III": [
                { "Course Name": "Fourier Series and Number Theory", Credits: 4 },
                { "Course Name": "Electromagnetic Theory", Credits: 3 },
                { "Course Name": "Electrical Machines - I", Credits: 3 },
                { "Course Name": "Measurements and Instrumentation", Credits: 3 },
                { "Course Name": "Electronic Devices and Circuits", Credits: 3 },
                { "Course Name": "Power Plant Engineering", Credits: 3 },
                { "Course Name": "Electronic Devices and Circuits Laboratory", Credits: 1 },
                { "Course Name": "Introduction to Python Programming", Credits: 3 }
            ],
            "Semester IV": [
                { "Course Name": "Electrical Machines - II", Credits: 3 },
                { "Course Name": "Transmission and Distribution", Credits: 3 },
                { "Course Name": "Digital Logic Circuits", Credits: 4 },
                { "Course Name": "Linear Integrated Circuits and Applications", Credits: 4 },
                { "Course Name": "Open Elective - I", Credits: 3 },
                { "Course Name": "Electrical Machines Laboratory", Credits: 2 },
                { "Course Name": "Soft Skills-I", Credits: 1 },
                { "Course Name": "Python Programming for Machine Learning", Credits: 2 }
            ],
            "Semester V": [
                { "Course Name": "Power System Analysis", Credits: 3 },
                { "Course Name": "Power Electronics", Credits: 3 },
                { "Course Name": "Control Systems", Credits: 3 },
                { "Course Name": "Professional Elective I", Credits: 3 },
                { "Course Name": "Microprocessors, Microcontrollers and Applications", Credits: 4 },
                { "Course Name": "Open Elective - II", Credits: 3 },
                { "Course Name": "Control and Instrumentation Laboratory", Credits: 1 },
                { "Course Name": "Design Thinking and Innovation", Credits: 2 },
                { "Course Name": "Soft Skills-II", Credits: 1 }
            ],
            "Semester VI": [
                { "Course Name": "Protection and Switchgear", Credits: 3 },
                { "Course Name": "Solid State Drives", Credits: 3 },
                { "Course Name": "Electric Energy Utilization and Conservation", Credits: 3 },
                { "Course Name": "Applications of IoT in Electrical Engineering", Credits: 3 },
                { "Course Name": "Professional Elective II", Credits: 3 },
                { "Course Name": "Professional Elective III", Credits: 3 },
                { "Course Name": "Power Electronics and Drives Laboratory", Credits: 1 },
                { "Course Name": "Applications of AI and ML in Electrical Engineering", Credits: 2 },
                { "Course Name": "Problem Solving Techniques", Credits: 1 }
            ],
            "Semester VII": [
                { "Course Name": "Smart Grid", Credits: 3 },
                { "Course Name": "Power System Operation and Control", Credits: 3 },
                { "Course Name": "Renewable Energy Systems", Credits: 4 },
                { "Course Name": "Professional Elective IV", Credits: 3 },
                { "Course Name": "Professional Elective V", Credits: 3 },
                { "Course Name": "Project Work", Credits: 4 },
                { "Course Name": "Summer Internship", Credits: 1 }
            ],
            "Semester VIII": [
                { "Course Name": "Power System Planning and Reliability", Credits: 3 },
                { "Course Name": "Electric Vehicle Technology", Credits: 3 },
                { "Course Name": "Professional Elective VI", Credits: 3 },
                { "Course Name": "Project Work (Final)", Credits: 8 },
                { "Course Name": "Seminar", Credits: 2 }
            ]
        };

        const gradeLetters = {
            10: "O", 9: "A+", 8: "A", 7: "B+", 6: "B", 5: "C"
        };

        let selectedSemester = null;
        let currentCourseIndex = 0;
        let courses = [];
        let courseSemesters = [];
        let grades = [];
        let resultTableBody = null;

        const semesterSelect = document.getElementById("semesterSelect");
        Object.keys(courseData).forEach(sem => {
            const option = document.createElement("option");
            option.value = sem;
            option.textContent = sem;
            semesterSelect.appendChild(option);
        });

        const courseDisplay = document.getElementById("courseDisplay");
        const liveGPA = document.getElementById("liveGPA");
        const semWiseGPA = document.getElementById("semWiseGPA");
        const resultTable = document.getElementById("resultTable");
        resultTableBody = resultTable.querySelector("tbody");

        function startCalculation() {
            selectedSemester = semesterSelect.value;
            if (!selectedSemester) {
                alert("Please select a semester.");
                return;
            }
            courses = [];
            courseSemesters = [];
            for (let sem of Object.keys(courseData)) {
                for (const course of courseData[sem]) {
                    courses.push(course);
                    courseSemesters.push(sem);
                }
                if (sem === selectedSemester) break;
            }
            currentCourseIndex = 0;
            grades = new Array(courses.length).fill(null);
            liveGPA.textContent = "-";
            semWiseGPA.textContent = "";
            resultTable.style.display = "table";
            resultTableBody.innerHTML = "";
            showNextCourse();
        }

        function showNextCourse() {
            if (currentCourseIndex >= courses.length) {
                courseDisplay.textContent = `All courses graded! Final CGPA: ${calculateCGPA().toFixed(2)}`;
                updateGPA();
                return;
            }
            const course = courses[currentCourseIndex];
            courseDisplay.innerHTML = `<strong>Course:</strong> ${course["Course Name"]} | <strong>Credits:</strong> ${course.Credits}`;
        }

        function submitGrade(grade) {
            if (currentCourseIndex >= courses.length) return;
            grades[currentCourseIndex] = grade;
            currentCourseIndex++;
            updateTable();
            updateGPA();
            showNextCourse();
        }

        function correctGrade() {
            if (currentCourseIndex === 0) {
                 // Using a custom modal/alert in the future would be better
                 courseDisplay.textContent = "No grade to correct!";
                 setTimeout(() => showNextCourse(), 2000);
                 return;
            }
            currentCourseIndex--;
            grades[currentCourseIndex] = null;
            updateTable();
            updateGPA();
            showNextCourse();
        }

        function restart() {
            selectedSemester = null;
            currentCourseIndex = 0;
            courses = [];
            grades = [];
            courseSemesters = [];
            courseDisplay.textContent = "";
            liveGPA.textContent = "-";
            semWiseGPA.textContent = "";
            resultTableBody.innerHTML = "";
            resultTable.style.display = "none";
            semesterSelect.selectedIndex = 0;
        }

        function updateTable() {
            resultTableBody.innerHTML = "";
            let totalWeightedPoints = 0;
            for (let i = 0; i < grades.length; i++) {
                if (grades[i] === null) break;
                totalWeightedPoints += grades[i] * courses[i].Credits;
            }

            for (let i = 0; i < grades.length; i++) {
                if (grades[i] === null) continue;
                const course = courses[i];
                const credit = course.Credits;
                const gradePoint = grades[i];
                const weighted = credit * gradePoint;
                const weightage = totalWeightedPoints ? (weighted / totalWeightedPoints).toFixed(3) : "0.000";

                const row = document.createElement("tr");
                row.className = "border-b border-gray-700";
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium text-white">${course["Course Name"]}</td>
                    <td class="px-6 py-4 text-center">${gradeLetters[gradePoint]}</td>
                    <td class="px-6 py-4 text-center">${credit}</td>
                    <td class="px-6 py-4 text-center">${gradePoint}</td>
                    <td class="px-6 py-4 text-center">${weighted}</td>
                    <td class="px-6 py-4 text-center">${weightage}</td>
                    <td class="px-6 py-4">${courseSemesters[i]}</td>
                `;
                resultTableBody.appendChild(row);
            }
        }

        function updateGPA() {
            if (grades.every(g => g === null)) {
                liveGPA.textContent = "-";
                semWiseGPA.textContent = "";
                return;
            }

            let totalCreditsAll = 0;
            let totalWeightedPointsAll = 0;
            const semCredits = {};
            const semWeightedPoints = {};

            for (let i = 0; i < grades.length; i++) {
                if (grades[i] === null) break;
                const sem = courseSemesters[i];
                const credit = courses[i].Credits;
                const gp = grades[i];
                const weighted = credit * gp;

                totalCreditsAll += credit;
                totalWeightedPointsAll += weighted;

                if (!semCredits[sem]) semCredits[sem] = 0;
                if (!semWeightedPoints[sem]) semWeightedPoints[sem] = 0;

                semCredits[sem] += credit;
                semWeightedPoints[sem] += weighted;
            }

            const cgpa = totalCreditsAll ? (totalWeightedPointsAll / totalCreditsAll) : 0;
            liveGPA.textContent = cgpa.toFixed(2);

            let semGPAStrings = [];
            for (const sem of Object.keys(semCredits)) {
                const gpa = semWeightedPoints[sem] / semCredits[sem];
                semGPAStrings.push(`<strong>${sem}:</strong> ${gpa.toFixed(2)}`);
            }
            semWiseGPA.innerHTML = "<strong>Semester-wise GPA:</strong> " + semGPAStrings.join(" | ");
        }

        function calculateCGPA() {
            let totalCredits = 0;
            let totalWeightedPoints = 0;
            for (let i = 0; i < grades.length; i++) {
                if (grades[i] === null) break;
                totalCredits += courses[i].Credits;
                totalWeightedPoints += grades[i] * courses[i].Credits;
            }
            return totalCredits === 0 ? 0 : totalWeightedPoints / totalCredits;
        }

        function downloadCSV() {
            if (grades.every(g => g === null)) {
                alert("No grades to export.");
                return;
            }
            const header = ["Course Name", "Grade", "Credits", "Grade Point", "Grade × Credits", "Weightage", "Semester"];
            let csvRows = [];
            csvRows.push(header.join(","));

            let totalWeightedPoints = 0;
            for (let i = 0; i < grades.length; i++) {
                if (grades[i] === null) break;
                totalWeightedPoints += grades[i] * courses[i].Credits;
            }

            for (let i = 0; i < grades.length; i++) {
                if (grades[i] === null) continue;
                const course = courses[i];
                const credit = course.Credits;
                const gradePoint = grades[i];
                const weighted = credit * gradePoint;
                const weightage = totalWeightedPoints ? (weighted / totalWeightedPoints).toFixed(3) : "0.000";
                const gradeLetter = gradeLetters[gradePoint];
                const sem = courseSemesters[i];
                const row = [`"${course["Course Name"]}"`, gradeLetter, credit, gradePoint, weighted, weightage, sem];
                csvRows.push(row.join(","));
            }

            const csvString = csvRows.join("\n");
            const blob = new Blob([csvString], { type: "text/csv" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "grades.csv";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
